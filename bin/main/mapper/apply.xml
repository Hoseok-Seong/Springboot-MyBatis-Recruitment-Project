<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="shop.mtcoding.job.model.apply.ApplyRepository">
   <insert id="insert">
      insert into apply_tb(user_id, enterprise_id, recruitment_post_id, sector, resume_id, created_at) values(#{userId}, #{enterpriseId}, #{recruitmentPostId}, #{sector}, #{resumeId}, now()) 
   </insert>
    
   <update id="updateById">
      update apply_tb set user_id = #{userId}, enterprise_id=#{enterprise_id}, field = #{field} where id = #{id}
   </update>

   <select id="findAll" resultType="shop.mtcoding.job.model.apply.Apply">
      select * from apply_tb
   </select>

   <select id="findById" resultType="shop.mtcoding.job.model.apply.Apply">
      select * from apply_tb where id = #{id}  
   </select>

   <delete id="deleteById">
      delete from apply_tb where id = #{id}
   </delete>

   <select id="findByUserIdWithRecruitmentPostId" resultType="shop.mtcoding.job.model.apply.Apply">
      select * from apply_tb where user_id = #{userId} and recruitment_post_id = #{recruitmentPostId}  
   </select>

   <delete id="deleteByUserIdWithRecruitmentPostId">
      delete from apply_tb where user_id = #{userId} and recruitment_post_id = #{recruitmentPostId}  
   </delete>

   <select id="findByUserId" resultType="shop.mtcoding.job.dto.apply.ApplyRespDto$ApplyListForUserRespDto">
      SELECT a.recruitment_post_id, e.enterprise_name, r.title, a.sector, a.resume_id, a.created_at
      FROM apply_tb a
      JOIN recruitment_post_tb r
      ON a.enterprise_id = r.enterprise_id
      LEFT OUTER JOIN enterprise_tb e
      ON a.enterprise_id = e.id
      WHERE user_id = #{userId}
   </select>

   <select id="findByEnterpriseId" resultType="shop.mtcoding.job.dto.apply.ApplyRespDto$ApplyListForEntRespDto">
      select a.user_id, u.username, a.recruitment_post_id, e.enterprise_name, r.title, a.created_at
      from apply_tb a
      join user_tb u
      on a.user_id = u.id
      left outer join enterprise_tb e
      on a.enterprise_id = e.id
      left outer join recruitment_post_tb r
      on a.recruitment_post_id = r.id
      where a.enterprise_id = #{enterpriseId}
   </select>
</mapper>